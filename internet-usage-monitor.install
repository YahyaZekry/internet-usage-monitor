# Internet Usage Monitor AUR Package Install Script
APP_NAME="internet-usage-monitor-git"
PKG_INSTALL_DIR="/usr/share/$APP_NAME"

# Create desktop shortcuts for easy access
create_desktop_shortcuts() {
    # Create setup desktop file
    cat > "/usr/share/applications/internet-monitor-setup.desktop" <<EOF
[Desktop Entry]
Version=1.0
Type=Application
Name=Internet Usage Monitor - Setup
Comment=Set up Internet Usage Monitor widget and daemon
Exec=bash $PKG_INSTALL_DIR/desktop_scripts/install.sh
Icon=network-wireless
Terminal=true
Categories=System;Monitor;Network;
Keywords=internet;usage;monitor;conky;network;
StartupNotify=false
EOF

    # Create uninstall desktop file
    cat > "/usr/share/applications/internet-monitor-uninstall.desktop" <<EOF
[Desktop Entry]
Version=1.0
Type=Application
Name=Internet Usage Monitor - Uninstall
Comment=Remove Internet Usage Monitor completely
Exec=bash $PKG_INSTALL_DIR/desktop_scripts/uninstall.sh
Icon=user-trash
Terminal=true
Categories=System;Monitor;Network;
Keywords=internet;usage;monitor;remove;uninstall;
StartupNotify=false
EOF

    # Make desktop files executable
    chmod 644 /usr/share/applications/internet-monitor-*.desktop
    
    # Copy desktop shortcuts to all user desktops (if Desktop folder exists)
    for user_home in /home/*; do
        if [ -d "$user_home/Desktop" ] && [ -w "$user_home/Desktop" ]; then
            cp /usr/share/applications/internet-monitor-setup.desktop "$user_home/Desktop/" 2>/dev/null || true
            cp /usr/share/applications/internet-monitor-uninstall.desktop "$user_home/Desktop/" 2>/dev/null || true
            # Make sure the user owns the files
            chown "$(basename "$user_home"):$(basename "$user_home")" "$user_home/Desktop/internet-monitor-"*.desktop 2>/dev/null || true
            chmod +x "$user_home/Desktop/internet-monitor-"*.desktop 2>/dev/null || true
        fi
    done
}

post_install() {
    echo "ğŸš€ Internet Usage Monitor v1.0.0 has been installed!"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo
    
    # Create desktop shortcuts
    create_desktop_shortcuts
    
    echo "âœ… Setup Options Available:"
    echo
    echo "ğŸ–¥ï¸  DESKTOP SHORTCUTS (Easiest):"
    echo "   â€¢ Look for 'Internet Usage Monitor - Setup' on your desktop"
    echo "   â€¢ Double-click to run the interactive setup"
    echo
    echo "âš¡ COMMAND LINE (Advanced):"
    echo "   â€¢ Run: internet-usage-monitor-setup"
    echo "   â€¢ Or: bash $PKG_INSTALL_DIR/desktop_scripts/install.sh"
    echo
    echo "ğŸ“ What the setup will do:"
    echo "   â€¢ Install required dependencies automatically"
    echo "   â€¢ Configure Conky widget for your desktop"
    echo "   â€¢ Set up usage monitoring daemon"
    echo "   â€¢ Create autostart entries"
    echo "   â€¢ Apply KDE Plasma 6 fixes if needed"
    echo
    echo "ğŸ¯ Quick Start:"
    echo "   1. Double-click the 'Setup' shortcut on your desktop"
    echo "   2. Follow the interactive prompts"
    echo "   3. Enjoy monitoring your internet usage!"
    echo
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "ğŸ§‰ Yerba Mate: Your internet usage monitor is ready to brew!"
}

post_upgrade() {
    echo "ğŸ”„ Internet Usage Monitor has been upgraded!"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    
    # Refresh desktop shortcuts
    create_desktop_shortcuts
    
    echo "âœ… What's been updated:"
    echo "   â€¢ Core monitoring scripts optimized"
    echo "   â€¢ Conky configuration improved"
    echo "   â€¢ KDE Plasma 6 compatibility enhanced"
    echo "   â€¢ Desktop shortcuts refreshed"
    echo
    echo "ğŸ“ Your existing data and configs are preserved!"
    echo "   â€¢ Usage data: ~/.local/share/$APP_NAME/"
    echo "   â€¢ Custom configs: ~/.config/$APP_NAME/"
    echo
    echo "ğŸ¯ To apply updates:"
    echo "   â€¢ Double-click the 'Setup' shortcut on your desktop"
    echo "   â€¢ Choose 'Update existing installation' when prompted"
    echo
    echo "ğŸ§‰ Yerba Mate: Your monitor got an upgrade - time to celebrate!"
}

# Clean up desktop files and applications on removal
cleanup_desktop_shortcuts() {
    # Remove desktop files from applications menu
    rm -f /usr/share/applications/internet-monitor-*.desktop
    
    # Remove desktop shortcuts from user desktops
    for user_home in /home/*; do
        if [ -d "$user_home/Desktop" ]; then
            rm -f "$user_home/Desktop/internet-monitor-"*.desktop 2>/dev/null || true
        fi
    done
}

post_remove() {
    echo "ğŸ—‘ï¸  Internet Usage Monitor has been removed from system."
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    
    # Clean up desktop shortcuts
    cleanup_desktop_shortcuts
    
    echo "âœ… System cleanup completed:"
    echo "   â€¢ Application files removed"
    echo "   â€¢ Desktop shortcuts removed"
    echo "   â€¢ Menu entries removed"
    echo
    echo "ğŸ“ Preserved user data (remove manually if desired):"
    echo "   â€¢ Usage data: ~/.local/share/$APP_NAME/"
    echo "   â€¢ Custom configs: ~/.config/$APP_NAME/"
    echo "   â€¢ Usage logs and history files"
    echo
    echo "ğŸš¨ To completely remove ALL data:"
    echo "   â€¢ Double-click the 'Uninstall' shortcut (if still available)"
    echo "   â€¢ Or run: bash ~/uninstall.sh (if copied to home)"
    echo
    echo "ğŸ§‰ Yerba Mate: Clean system, clear mind. Thanks for using our monitor!"
}
